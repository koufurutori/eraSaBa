;FileName_USERCOM.ERB ------------------------------ Rev1. 00
;커맨드 표시 처리
;CALL		SYSTEM
;ARG		VOID
;RETURN		VOID
;COMMENT	
;-----------------------------------------------------------
@SHOW_USERCOM
#DIM DYNAMIC printKojoCom
TFLAG:100 = !TFLAG:101
VARSET LOCAL
;전턴의 MASTER가 사정한 상대를 LOCAL:1에 세트
IF TCVAR:MASTER:112 == 1
	;V
	LOCAL:1 = MASTER_POSE(SET_V, SET_P, 1)
ELSEIF TCVAR:MASTER:112 == 2
	;A
	LOCAL:1 = MASTER_POSE(SET_A, SET_P, 1)
ENDIF


CALL LOOK_AT
PRINTL

CALL 필터표시

;커맨드 표시
FOR LOCAL,0,800
	SIF LOCAL == 355
		CONTINUE
	SIF LOCAL == 200 && TFLAG:102 == 2
		PRINTL
	SIF LOCAL == 300 && printKojoCom
		PRINTL
	SIF LOCAL == 350 && TFLAG:102 != 2
		PRINTL
	SIF LOCAL == 400 && TFLAG:102 != 2
		PRINTL
	SIF GLOBAL_COMABLE2(LOCAL)
		CONTINUE
	SIF GROUPMATCH(LOCAL,400,405,604)
		CONTINUE
	RESULT = 0
	;현상으로 대상 커맨드가 사용 가능한가 어떤가 판정
	TRYCALLFORM COM_ABLE{LOCAL}
	IF RESULT
		SIF !QUICKFILTER(LOCAL)
			CONTINUE
		IF (LOCAL == 42 && TEQUIP:11) || (LOCAL == 43 && TEQUIP:12) || (LOCAL == 44 && TEQUIP:13) || (LOCAL == 45 && TEQUIP:14) || (LOCAL == 46 && TEQUIP:15) || (LOCAL == 47 && TEQUIP:16) || (LOCAL == 48 && TEQUIP:17)
			PRINTFORMC %TRAINNAME:LOCAL% 해제[{LOCAL, 3}]
		ELSEIF LOCAL == 15
			IF CFLAG:MASTER:장난
				PRINTFORMC 음부 애무[{LOCAL,3}]
			ELSE
				PRINTFORMC 클리 애무[{LOCAL,3}]
			ENDIF
		ELSEIF LOCAL == 81 && LOCAL:1
			PRINTFORMC 청소 펠라[{LOCAL, 3}]
		ELSEIF LOCAL == 82 && (TALENT:105 == -2 || TALENT:105 == -1)
			PRINTFORMC 나이즈리[{LOCAL , 3}]
		ELSEIF LOCAL == 60 && (!BEDROOM(CFLAG:PLAYER:현재위치) && !(BATHROOM() && ITEM:20))
			PRINTFORMC 대면입위[{LOCAL, 3}]
		ELSEIF LOCAL == 61 && (!INROOM(CFLAG:PLAYER:현재위치) && !(BATHROOM() && ITEM:20))
			PRINTFORMC 배면입위[{LOCAL, 3}]
		ELSEIF LOCAL == 62 && (!BEDROOM(CFLAG:PLAYER:현재위치) && !(BATHROOM() && ITEM:20))
			PRINTFORMC 대면입위 애널[{LOCAL, 3}]
		ELSEIF LOCAL == 63 && (!INROOM(CFLAG:PLAYER:현재위치) && !(BATHROOM() && ITEM:20))
			PRINTFORMC 배면입위 애널[{LOCAL, 3}]
		ELSEIF LOCAL == 73 && TCVAR:PLAYER:이기초
			IF TEQUIP:TARGET:체위 == 1 && (BEDROOM(CFLAG:PLAYER:현재위치) || (BATHROOM() && ITEM:20))
				PRINTFORMC 교배 프레스[{LOCAL, 3}]
			ELSEIF TEQUIP:TARGET:체위 == 2
				IF CFLAG:TARGET:생리주기 == 7
					PRINTFORMC 잉태 교미[{LOCAL, 3}]
				ELSE
					PRINTFORMC 교배 교미[{LOCAL, 3}]
				ENDIF
			ELSE
				PRINTFORMC %TRAINNAME:LOCAL%[{LOCAL, 3}]
			ENDIF
		ELSEIF LOCAL == 92 && (!BEDROOM(CFLAG:PLAYER:현재위치) && !(BATHROOM() && ITEM:20))
			PRINTFORMC A대면입위받는다[{LOCAL, 3}]
		ELSEIF LOCAL == 93 && (!INROOM(CFLAG:PLAYER:현재위치) && !(BATHROOM() && ITEM:20))
			PRINTFORMC A배면입위받는다[{LOCAL, 3}]
		ELSEIF LOCAL == 100 && TALENT:TARGET:유치
			PRINTFORMC 엉덩이 팡팡[{LOCAL, 3}]
		ELSEIF LOCAL == 130 && (!BEDROOM(CFLAG:PLAYER:현재위치) && !(BATHROOM() && ITEM:20))
			PRINTFORMC 대면입위받는다[{LOCAL, 3}]
		ELSEIF LOCAL == 131 && (!INROOM(CFLAG:PLAYER:현재위치) && !(BATHROOM() && ITEM:20))
			PRINTFORMC 배면입위받는다[{LOCAL, 3}]
		ELSEIF LOCAL == 300 && TCVAR:TARGET:302 && ABL:MASTER:화술기능 >= 4
			SETCOLOR C_ORANGE
			PRINTFORMC 회화[{LOCAL,3}]
			RESETCOLOR
		ELSEIF LOCAL == 301 && CFLAG:TARGET:행동 == 5
			PRINTFORMC 차를 탄다[{LOCAL, 3}]
		ELSEIF LOCAL == 301 && GETBIT(TCVAR:MASTER:특별한차, 0)
			PRINTFORMC 홍차를 탄다[{LOCAL, 3}]
		ELSEIF LOCAL == 334 && CFLAG:TARGET:350 == 49 && (TALENT:TARGET:술내성 == -2 )
			PRINTFORMC 요리를 권한다[{LOCAL, 3}]
		ELSEIF LOCAL == 304 && CFLAG:TARGET:350 == 46
			PRINTFORMC 놀이에 참가한다[{LOCAL, 3}]
		ELSEIF LOCAL == 315
			IF GETBIT(TALENT:TARGET:성별, 1)
				PRINTFORMC 좆대 애무[{LOCAL, 3}]
			ELSEIF CFLAG:MASTER:장난
				PRINTFORMC 음부 애무[{LOCAL, 3}]
			ELSE
				PRINTFORMC 클리 애무[{LOCAL, 3}]
			ENDIF
		ELSEIF LOCAL == 350
	
			;침대가 없다
			;실외
			IF !INROOM(CFLAG:PLAYER:현재위치)
				LOCALS = 껴안는다
			ELSE
				LOCALS = 덮친다
			ENDIF
			SIF GET_TARGETNUM() > 1
				LOCALS = 한꺼번에 %LOCALS%
			PRINTFORMC %LOCALS%[{LOCAL,3}]
		ELSEIF LOCAL == 351
			IF CFLAG:TARGET:동행
			ELSEIF COM_351_CONDITION(TARGET) == 1
				SETCOLOR 100, 100, 100
			ELSEIF CAN_IRAI_CHARA_GO_TOGATHER(TARGET)
				SETCOLOR C_GREEN
			ELSE
				SETCOLOR C_AQUA
			ENDIF
			PRINTFORMC %TRAINNAME:LOCAL%[{LOCAL,3}]
			RESETCOLOR
		ELSEIF LOCAL == 491
			SETCOLOR 255, 179, 167
			PRINTFORMC %TRAINNAME:LOCAL%[{LOCAL,3}]
			RESETCOLOR
		ELSEIF LOCAL == 360 && BASE:MASTER:기력 <= 0
			PRINTFORMC 남 하는 대로[{LOCAL,3}]
		ELSEIF LOCAL == 366 && GROUPMATCH(IRAI_CHARA_TO_PROGRESS(TARGET), "의뢰 달성", "의뢰 실패")
			SETCOLOR C_GREEN
			PRINTFORMC 의뢰 보고[{LOCAL,3}]
			RESETCOLOR
		ELSEIF LOCAL == 366 && GROUPMATCH(IRAI_CHARA_TO_PROGRESS(TARGET), "의뢰미수탁")
			SETCOLOR C_GREEN
			PRINTFORMC 의뢰를 듣는다[{LOCAL,3}]
			RESETCOLOR
		ELSEIF LOCAL == 367
			SETCOLOR C_GREEN
			PRINTFORMC %NAME_IRAI_ACT()%[{LOCAL,3}]
			RESETCOLOR
		ELSEIF LOCAL == 368
			;PRINTFORMC %자유행동에맡김_명칭(TARGET)%[{LOCAL,3}]
			PRINTFORMC %FreeAct_Name(TARGET)%[{LOCAL,3}]
		ELSEIF LOCAL == 337
		
		ELSEIF LOCAL == 417 && TIME >= 660 && TIME <= 900
			PRINTFORMC 낮잠 잔다[{LOCAL,3}]
		ELSEIF LOCAL == 417
			PRINTFORMC 선잠 잔다[{LOCAL,3}]
	

		; ELSEIF LOCAL == 405 && CFLAG:TARGET:동행 && TARGET
		; 	PRINTFORMC 데이트[{LOCAL, 3}]
		ELSEIF LOCAL == 410 && OUTROOF(CFLAG:MASTER:현재위치) && DAY:2 == 4
			PRINTFORMC 눈치우기[{LOCAL,3}]
		ELSEIF LOCAL == 414 && TIME >= 300 && TIME <= 540 && (CFLAG:MASTER:현재위치 == OMANEKIBEYA())
			PRINTFORMC 아침 식사를 한다[{LOCAL,3}]
		ELSEIF LOCAL == 414 && TIME >= 660 && TIME <= 900 && (CFLAG:MASTER:현재위치 == OMANEKIBEYA())
			PRINTFORMC 점심 식사를 한다[{LOCAL,3}]
		ELSEIF LOCAL == 414 && TIME >= 1020 && TIME <= 1200 && (CFLAG:MASTER:현재위치 == OMANEKIBEYA())
			PRINTFORMC 저녁 식사를 한다[{LOCAL,3}]
		ELSEIF LOCAL == 414 && TIME >= 1200 && TIME <= 1440 && (CFLAG:MASTER:현재위치 == OMANEKIBEYA())
			PRINTFORMC 늦은 식사를 한다[{LOCAL,3}]
		ELSEIF LOCAL == 414 && TIME >= 0 && TIME <= 180 && (CFLAG:MASTER:현재위치 == OMANEKIBEYA())
			PRINTFORMC 야식을 먹는다[{LOCAL,3}]
		ELSEIF LOCAL == 414 && CFLAG:TARGET:행동 == 5
			PRINTFORMC 식사 휴식[{LOCAL,3}]
		ELSEIF LOCAL == 443
			PRINTFORMC %NAME_UNIQUE_COM(TARGET)%[{LOCAL,3}]
		ELSEIF LOCAL == 448
			IF GROUPMATCH(CFLAG:MASTER:현재위치, TRAP_POINT:1, TRAP_POINT:2, TRAP_POINT:3)
				PRINTFORMC 덫을 본다[{LOCAL,3}]
			ELSE
				PRINTFORMC %TRAINNAME:LOCAL%[{LOCAL,3}]
			ENDIF
		ELSEIF LOCAL == 464
			SELECTCASE CFLAG:MASTER:현재위치
		
			
			ENDSELECT
		ELSEIF LOCAL == 482
			PRINTFORMC %조사처리(CALLNAME:STALKED,"를")% 쫒는다[{LOCAL,3}]
		ELSEIF LOCAL == 626
			PRINTFORMC %GIFTSHOP_NAME(CFLAG:MASTER:데이트중, 1)%[{LOCAL,3}]
		ELSEIF LOCAL == 603 && PREVCOM == 603
			PRINTFORMC 손을 잡아당긴다[{LOCAL, 3}]
		ELSEIF LOCAL == 698
			PRINTFORMC %OMANEKI_PLACE()%로 간다[{LOCAL, 3}]
		;kojo com
		ELSEIF LOCAL >= 270 && LOCAL < 300
			CALL KOJO_MESSAGE_SEND("COM", 0, TARGET, LOCAL - 270)
			PRINTFORMC %RESULTS%[{LOCAL,3}]
			printKojoCom = 1
		ELSEIF STRLENS(TRAINNAME:LOCAL)
			PRINTFORMC %TRAINNAME:LOCAL%[{LOCAL, 3}]
		ENDIF
	ENDIF
NEXT
RESULT = 0
;자동 실행중이라면 아래와 같이 표시를 스킵
SIF !TFLAG:100
	GOTO SKIP
PRINTL
CALL PRINTBUTTON_EX(TFLAG:USERCOM비표시 ? "▽[＋][Ex_COM] ==" # "▼[－][Ex_COM] ==", 3002, TFLAG:USERCOM비표시)
; 개인 임의수정, CONFIG 폭에 따른 = 개수 자동조정
;PRINTFORML %"=" * 100%    ;original
PRINTFORML %"=" * (GETCONFIG("ウィンドウ幅") / 8 - 18)%
SIF TFLAG:USERCOM비표시
	GOTO SKIP
;SIF !GETBIT (FLAG:USERCOM필터, 12)
;	PRINTC 이력 표시[800]
IF GETBIT(FLAG:순간이동, 1) && !CFLAG:MASTER:동행
	SETCOLOR 0x5090FF
ELSE
	SETCOLOR C_GREEN
ENDIF
RESULT = 0
CALL COM_ABLE400
SIF RESULT
	PRINTC 이동[400]
RESULT = 0
RESETCOLOR

;일단 데이트도 막혔고 나간다 버튼도 안 되니까 막아 둠. 데이트가 내부에서도 가능하게 활상화하면 버튼 다시 줄 필요 있음.
;CALL COM_ABLE405
;IF RESULT
;	IF CFLAG:TARGET:동행 && TARGET
;		PRINTC 데이트[405]
;	ELSE 
;		PRINTC 나간다[405]
;	ENDIF
;ENDIF


RESULT = 0

IF GETBIT(FLAG:순간이동, 0) && !FLAG:데이트상대
	SETCOLOR 0x5090FF
ELSE
	SETCOLOR C_GREEN
ENDIF
RESULT = 0
CALL COM_ABLE604
SIF RESULT
	PRINTC 산책[604]
RESETCOLOR
SIF !GETBIT (FLAG:USERCOM필터, 0)
	PRINTC 불결 표시[801]
SIF !CFLAG:동침중 && GET_TARGETNUM() > 1 && !GETBIT (FLAG:USERCOM필터, 1)
	PRINTC 상대를 바꾼다[802]
SIF !GETBIT (FLAG:USERCOM필터, 2)
	PRINTC 능력 표시[803]
SIF !GETBIT (FLAG:USERCOM필터, 3)
	PRINTC 능력 표시(마스터)[804]
SIF !GETBIT (FLAG:USERCOM필터, 4)
	PRINTC 아이템 확인[805]
SIF !GETBIT(FLAG:USERCOM필터, 11)
	PRINTC 커맨드필터[809]
SIF FLAG:1005
	PRINTC CONFIG[810]
SIF TALENT:MASTER:위치짐작 && AT_HOME(MASTER) && (GETBIT(TALENT:MASTER:위치짐작, 1) || !(CFLAG:우후후 || CFLAG:장난 || CFLAG:동침중))
	PRINTC 위치짐작[811]
SIF TALENT:MASTER:오방짐작 && AT_HOME(MASTER) && !(CFLAG:우후후 || CFLAG:장난 || CFLAG:동침중)
	PRINTC 더러운 방 짐작[812]
SIF GETBIT(TALENT:MASTER:정욕감지, 1) && !CFLAG:우후후
	PRINTC 정욕 탐지[813]
SIF GATHERING_SPOT(CFLAG:MASTER:현재위치) != 0
	PRINTC 채집 리스트[818]

IF CAN_DATE(TARGET)
	
ENDIF

IF TALENT:MASTER:179 ;채양보음/채음보양 KR판 구잔재 또는 오리지날
	IF !GETBIT(TALENT:MASTER:179,0)&&!GETBIT(TALENT:MASTER:179,1) 
		PRINTC 채양보음／채음보양[990]
	ELSE
		PRINTFORMC %GET_TALENTNAME(179, TALENT:MASTER:179)% 사용중[990]
	ENDIF
ENDIF
	
SIF CFLAG:MASTER:현재위치 == CFLAG:MASTER:초기위치 && !FLAG:자실잠금 ;내 방(신사 이외 가능) 잠금기능 KR판 구잔재
	PRINTC 잠근다[991]
SIF CFLAG:MASTER:현재위치 == CFLAG:MASTER:초기위치 && FLAG:자실잠금
	PRINTC 잠금을 푼다[991]


SIF CAN_DATE(TARGET)
	PRINTC 데이트 신청한다[992]
SIF CFLAG:MASTER:현재위치 == CFLAG:MASTER:초기위치
	PRINTC 달력[993]
SIF FLAG:팬티수송
	PRINTC 소지 팬티 확인[994]
IF AT_HOME(MASTER) && GETBIT(FLAG:순간이동, 1)
	SETCOLOR 0x5090FF
ELSEIF !AT_HOME(MASTER) && GETBIT(FLAG:순간이동, 0)
	SETCOLOR 0x5090FF
ENDIF
;SIF !GETBIT(FLAG:USERCOM필터, 13)
;	PRINTC 자동 시간정지 이동[995]
RESETCOLOR

;자동청소
IF AT_HOME(MASTER) && GETBIT(FLAG:자동청소, 1)
	SETCOLOR 0x5090FF
ELSEIF !AT_HOME(MASTER) && GETBIT(FLAG:자동청소, 0)
	SETCOLOR 0x5090FF
ENDIF
;SIF !GETBIT(FLAG:USERCOM필터, 14) & AT_HOME(MASTER) && !CFLAG:우후후 && !CFLAG:동침중
;	PRINTC 자동청소[996]
RESETCOLOR

PRINTL
IF CFLAG:우후후 && !CFLAG:장난
	SIF EQUIP:0 && TARGET && !(TFLAG:102 == 3 && TFLAG:껴안기모드)
		PRINTC 옷을 벗긴다[820]
		IF TARGET
			IF TEQUIP:애태우기모드
				PRINTC 애태우기 종료[826]
			ELSE
				PRINTC 애태운다[826]
			ENDIF
		ENDIF
	IF CFLAG:우후후 == 2
		IF TFLAG:껴안기모드
			PRINTC 뿌리친다[850]
		ELSE
			PRINTC 빠져나간다[850]
		ENDIF
	ELSE
		PRINTC 밀회 종료[999]
	ENDIF
ENDIF

IF CFLAG:장난
	SIF CFLAG:장난 < 2 && (EXP:TARGET:수면간경험 > 100 || TCVAR:수면제강도 || TCVAR:수면심도 > 2000)
		PRINTC 옷을 헤친다[830]
	IF CFLAG:장난 < 2
		PRINTC 장난 종료[999]
		IF EQUIP:TARGET:하반신속옷2
			IF !PANTS_ALREADY_COLLECTED()
				FONTBOLD
				SETCOLOR COLOR("PINK")
			ENDIF
			PRINTC 팬티를 훔친다[821]
			RESETCOLOR
			FONTREGULAR
		ENDIF
	ENDIF
	SIF CFLAG:장난 > 1
	PRINTC 수면간 종료[999]
ENDIF
IF CFLAG:동침중
	PRINTC 동침 종료[999]
ENDIF




IF CHK_DATENOW(CFLAG:MASTER:데이트중) && !CFLAG:MASTER:우후후 && CFLAG:MASTER:현재위치 != OMANEKIBEYA() && TFLAG:망상중 != 1
	
ENDIF









$SKIP
IF PREVCOM >= 0
	IF TFLAG:151
		STR:0 = %STR:(1500 + TFLAG:151)%
	ELSE
		STR:0 = %TRAINNAME:PREVCOM%
	ENDIF
ENDIF
SIF PREVCOM == 304 && CFLAG:TARGET:350 == 49 && TALENT:TARGET:술내성 != -2
	STR:0 = 잔를 나눈다
SIF PREVCOM == 304 && CFLAG:TARGET:350 == 49 && (TALENT:TARGET:술내성 == -2 )
	STR:0 = 요리를 권한다
SIF PREVCOM == 304 && CFLAG:TARGET:350 == 51
	STR:0 = 간호한다
;kojo com
IF INRANGE(PREVCOM, 270, 299)
	CALL KOJO_MESSAGE_SEND("COM", 0, TARGET, PREVCOM - 270)
	STR:0 '= RESULTS
ENDIF
IF !TFLAG:USERCOM비표시
	IF PREVCOM >= 0 && PREVCOM < 300
		PRINTL 
		PRINT ＜전회 조교 커맨드:
		PRINTS STR:0
		SIF TFLAG:150
			PRINT (조수)
		PRINTL ＞
	ELSE
		PRINTL 
		PRINT ＜전회 커맨드:
		PRINTS STR:0
		PRINTL ＞
	ENDIF
ENDIF
